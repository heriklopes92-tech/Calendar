// ============================================
// GARANTIA DE VISUALIZA√á√ÉO IGUAL EM TODOS OS DISPOSITIVOS
// ============================================

/**
 * Garante que todas as informa√ß√µes est√£o vis√≠veis e com tamanho adequado
 */
function garantirVisualizacaoConsistente() {
    const largura = window.innerWidth;
    const isMobile = largura <= 768;
    
    console.log(`üì± Dispositivo: ${largura}px - ${isMobile ? 'Mobile' : 'Desktop'}`);
    
    if (isMobile) {
        console.log('üìê Aplicando ajustes para visualiza√ß√£o consistente...');
        
        // 1. GARANTE que n√∫meros dos dias est√£o GRANDES
        document.querySelectorAll('.day-number').forEach(numero => {
            // Aplica tamanhos consistentes baseados na largura
            let tamanhoFonte = '1.2rem'; // Padr√£o desktop
            
            if (largura <= 480) {
                tamanhoFonte = '1.1rem';
            }
            if (largura <= 360) {
                tamanhoFonte = '1rem';
            }
            
            numero.style.cssText = `
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                font-size: ${tamanhoFonte} !important;
                font-weight: 700 !important;
                color: #333 !important;
                margin-bottom: 8px !important;
            `;
        });
        
        // 2. GARANTE que mensagens est√£o GRANDES
        document.querySelectorAll('.day-message').forEach(mensagem => {
            let tamanhoFonte = '0.85rem'; // Padr√£o desktop
            
            if (largura <= 480) {
                tamanhoFonte = '0.8rem';
            }
            if (largura <= 360) {
                tamanhoFonte = '0.75rem';
            }
            
            mensagem.style.cssText = `
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                font-size: ${tamanhoFonte} !important;
                line-height: 1.4 !important;
                color: #555 !important;
                max-height: 70px !important;
                overflow-y: auto !important;
            `;
        });
        
        // 3. GARANTE altura adequada das c√©lulas
        document.querySelectorAll('.day-cell').forEach(celula => {
            let altura = '120px'; // Padr√£o desktop
            
            if (largura <= 480) {
                altura = '110px';
            }
            if (largura <= 360) {
                altura = '105px';
            }
            
            celula.style.minHeight = `${altura} !important`;
        });
        
        // 4. Bot√µes de a√ß√£o sempre vis√≠veis em mobile
        document.querySelectorAll('.message-actions').forEach(acoes => {
            acoes.style.cssText = `
                opacity: 1 !important;
                display: flex !important;
                gap: 5px !important;
                margin-top: 10px !important;
            `;
        });
        
        // 5. Ajusta t√≠tulos para manter propor√ß√£o
        if (largura <= 480) {
            const titulo = document.querySelector('header h1');
            if (titulo && parseFloat(getComputedStyle(titulo).fontSize) < 28) {
                titulo.style.fontSize = '1.8rem';
            }
        }
        
        console.log('‚úÖ Visualiza√ß√£o consistente aplicada!');
    } else {
        // Em desktop, garante que n√£o h√° estilos mobile interferindo
        document.querySelectorAll('.day-number').forEach(numero => {
            numero.style.cssText = '';
        });
        
        document.querySelectorAll('.day-message').forEach(mensagem => {
            mensagem.style.cssText = '';
        });
        
        document.querySelectorAll('.day-cell').forEach(celula => {
            celula.style.minHeight = '';
        });
        
        document.querySelectorAll('.message-actions').forEach(acoes => {
            acoes.style.cssText = '';
        });
    }
}

/**
 * Monitora e aplica corre√ß√µes automaticamente
 */
function iniciarMonitorVisualizacao() {
    // Aplica imediatamente
    garantirVisualizacaoConsistente();
    
    // Aplica ap√≥s renderiza√ß√£o do calend√°rio
    const renderOriginal = window.renderCalendar;
    if (renderOriginal) {
        window.renderCalendar = function() {
            const resultado = renderOriginal.apply(this, arguments);
            setTimeout(garantirVisualizacaoConsistente, 100);
            return resultado;
        };
    }
    
    // Aplica ao redimensionar
    window.addEventListener('resize', function() {
        setTimeout(garantirVisualizacaoConsistente, 300);
    });
    
    // Aplica periodicamente por seguran√ßa (s√≥ em mobile)
    if (window.innerWidth <= 768) {
        setInterval(garantirVisualizacaoConsistente, 3000);
    }
    
    console.log('üëÅÔ∏è Monitor de visualiza√ß√£o iniciado');
}

// ============================================
// INICIALIZA√á√ÉO
// ============================================

// Quando o DOM carregar
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Iniciando garantia de visualiza√ß√£o...');
        iniciarMonitorVisualizacao();
    });
} else {
    // Se j√° carregou
    console.log('üöÄ DOM pronto, aplicando garantia de visualiza√ß√£o...');
    iniciarMonitorVisualizacao();
}

// ============================================
// FUN√á√ïES DE TESTE
// ============================================

window.testarVisualizacao = function() {
    console.log('üß™ Testando visualiza√ß√£o...');
    console.log(`Largura: ${window.innerWidth}px`);
    
    const numeros = document.querySelectorAll('.day-number');
    const primeiroNumero = numeros[0];
    
    if (primeiroNumero) {
        const estilo = window.getComputedStyle(primeiroNumero);
        console.log(`üìä N√∫mero do dia:`);
        console.log(`   Tamanho da fonte: ${estilo.fontSize}`);
        console.log(`   Vis√≠vel: ${estilo.visibility !== 'hidden' && estilo.opacity !== '0'}`);
        console.log(`   Cor: ${estilo.color}`);
    }
    
    garantirVisualizacaoConsistente();
    console.log('‚úÖ Teste completo');
};

// Comando r√°pido para for√ßar visualiza√ß√£o consistente
window.visualizacaoIgual = function() {
    console.log('üîÑ For√ßando visualiza√ß√£o igual em todos dispositivos...');
    garantirVisualizacaoConsistente();
    alert('Visualiza√ß√£o consistente aplicada! Tamanhos mantidos igual ao desktop.');
};
